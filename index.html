<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Smart City Dashboard</title>
  <script src="https://static.sketchfab.com/api/sketchfab-viewer-1.12.0.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Orbitron', sans-serif;
      background: linear-gradient(to right, #0f2027, #203a43, #2c5364);
      color: #00ffff;
      overflow: hidden;
    }

    .container {
      display: flex;
      height: 100vh;
    }

    .left-pane {
      flex: 7.5;
      position: relative;
      background-color: #000;
      border-right: 2px solid rgba(0, 255, 255, 0.2);
      box-shadow: inset 0 0 30px #00eaff55;
    }

    .right-pane {
      flex: 2;
      padding: 18px;
      background: radial-gradient(circle, #0a1e2f, #06121f);
      overflow-y: auto;
      color: #c5faff;
    }

    #skfb-frame {
      width: 100%;
      height: 100%;
      border: none;
      filter: drop-shadow(0 0 20px #00eaff);
    }

    .camera-section {
      margin-bottom: 12px;
      padding-bottom: 10px;
      border-bottom: 1px dashed rgba(0, 255, 255, 0.1);
    }

    .camera-title {
      font-size: 18px;
      font-weight: bold;
      color: #00ffff;
      margin-bottom: 5px;
      border-left: 4px solid #00eaff;
      padding-left: 8px;
    }

    .camera-image img {
      display: block;
      margin-left: auto;
      margin-right: auto;
      width: 100%;
      height: auto;
      border-radius: 8px;
      border: 1px solid #00eaff;
      box-shadow: 0 0 12px #00eaff66;
      margin-bottom: 8px;
      transition: transform 0.3s ease;
    }

    .camera-image img:hover {
      transform: scale(1.03);
    }

    .camera-detail {
      font-size: 14px;
      background-color: rgba(0, 255, 255, 0.05);
      border-left: 3px solid #00ffff;
      padding: 10px;
      border-radius: 5px;
      line-height: 1.4;
      box-shadow: 0 0 8px #00c8ff44;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="left-pane">
      <iframe id="skfb-frame" allow="autoplay; fullscreen; xr-spatial-tracking" allowfullscreen></iframe>
    </div>

    <div class="right-pane">
      <div class="camera-section">
        <div class="camera-title" id="cameraNameBox">üì∑ ‡∏£‡∏≠‡∏Å‡∏î Annotation ‡∏Å‡∏•‡πâ‡∏≠‡∏á...</div>
        <div class="camera-image" id="infoBox">‚ÑπÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ</div>
        <div class="camera-detail" id="infoBox2">‚ÑπÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ</div>
        <div class="camera-detail" id="infoBox3">‚ÑπÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ</div>
        <div class="camera-detail" id="infoBox4">‚ÑπÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ</div>
        <div class="camera-detail" id="infoBox5">‚ÑπÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ</div>
      </div>
    </div>
  </div>

  <script>
    const iframe = document.getElementById('skfb-frame');
    const client = new Sketchfab(iframe);
    let CameraName = '';

    function getTextFromGoogleSheet(cameraId) {
      const sheetID = "1pG8ldAgtHsOzlVxjITuBp2XCS77Sdk15fvmR-YU-MDg";
      const sheetName = "Data";
      const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json&sheet=${sheetName}`;

      fetch(url)
        .then(res => res.text())
        .then(data => {
          const jsonData = JSON.parse(data.substr(47).slice(0, -2));
          const rows = jsonData.table.rows;

          for (let i = 0; i < rows.length; i++) {
            const row = rows[i].c;
            if (row[0] && row[0].v === cameraId) {
              // ‡∏Å‡∏•‡πâ‡∏≠‡∏á 1
              const img1 = row[2]?.v || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
              const text1 = row[3]?.v || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
              const text2 = row[4]?.v || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
              const text3 = row[5]?.v || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
              const text4 = row[6]?.v || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';

              document.getElementById("infoBox").innerHTML = `<img src="${img1}" alt="‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á">`;
              document.getElementById("infoBox2").innerText = text1;
              document.getElementById("infoBox3").innerText = text2;
              document.getElementById("infoBox4").innerText = text3;
              document.getElementById("infoBox5").innerText = text4;

              break;
            }
          }
        })
        .catch(err => console.error("‚ùå Error loading Google Sheet:", err));
    }

    client.init('7adcd28260174cf58dd2672e1e189426', {
      success: function (api) {
        api.start();
        api.addEventListener('viewerready', function () {
          api.addEventListener('annotationFocus', function (index) {
            api.getAnnotation(index, function (err, annotation) {
              if (!err && annotation?.name) {
                CameraName = annotation.name;
                document.getElementById('cameraNameBox').innerText = '‡∏ä‡∏±‡πâ‡∏ô ' + CameraName;
                getTextFromGoogleSheet(CameraName);
              }
            });
          });
        });
      },
      error: function () {
        console.error('‚ùå ‡πÇ‡∏´‡∏•‡∏î Sketchfab API ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ');
      }
    });
  </script>
</body>
</html>
